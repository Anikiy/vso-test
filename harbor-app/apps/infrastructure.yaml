applications:
  # Секреты (VaultStaticSecret) — синхронизируются первыми, независимо от Helm chart
  harbor-stage-secrets:
    additionalLabels:
      env: stage
      team: devinfra
    additionalAnnotations: {}
    finalizers:
    - resources-finalizer.argocd.argoproj.io
    project: devinfra
    source:
      repoURL: git@github.com:YuriB9/vso-test.git
      path: harbor-app/components/infra/harbor/stage/secrets
      targetRevision: master
    destination:
      server: https://kubernetes.default.svc
      namespace: harbor-stage
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      syncOptions:
      - CreateNamespace=true

  # Helm chart (ApplicationSet) — зависит от секретов выше
  harbor:
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
    - resources-finalizer.argocd.argoproj.io
    project: devinfra
    sources:
      - repoURL: https://argoproj.github.io/argo-helm
        chart: argocd-apps
        targetRevision: 2.0.2
        helm:
          valueFiles:
            - $values/harbor-app/components/infra/harbor/applicationsets.yaml
      - repoURL: git@github.com:YuriB9/vso-test.git
        ref: values
        targetRevision: master
    destination:
      server: https://kubernetes.default.svc
      namespace: argocd
    syncPolicy:
      syncOptions:
      - CreateNamespace=true
